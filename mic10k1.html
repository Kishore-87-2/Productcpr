<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Comparison</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            position: relative;
        }
        
        .export-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 10px 15px;
            background-color: #007bff;
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 5px;
            font-size: 14px;
        }

        .export-btn:hover {
            background-color: #0056b3;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            font-size: 14px;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
            vertical-align: top;
        }

        th {
            background-color: #f4f4f4;
            font-weight: bold;
        }

        select {
            padding: 8px;
            margin: 10px 5px;
            font-size: 14px;
            min-width: 200px;
        }
        
        .compare-all-btn {
            padding: 10px 15px;
            background-color: #28a745;
            color: white;
            border: none;
            cursor: pointer;
            font-size: 14px;
            margin-top: 15px;
            border-radius: 5px;
        }

        .compare-all-btn:hover {
            background-color: #218838;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            color: #333;
        }

        label {
            font-weight: bold;
            margin-right: 10px;
        }

        .controls {
            margin-bottom: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <button class="export-btn" onclick="exportToPDF()">Export to PDF</button>

        <h1>Product Comparison</h1>

        <div class="controls">
            <div>
                <label for="productSelect">Main Product:</label>
                <select id="productSelect" onchange="updateCompetitorOptions()">
                    <option value="Sonel MIC-10K1">Sonel MIC-10K1</option>
                </select>
            </div>

            <div>
                <label for="competitorSelect">Competitor 1:</label>
                <select id="competitorSelect" onchange="loadComparisonTable()"></select>
            </div>

            <div>
                <label for="competitorSelect2">Competitor 2:</label>
                <select id="competitorSelect2" onchange="loadComparisonTable()">
                    <option value="none">None</option>
                </select>
            </div>

            <button class="compare-all-btn" onclick="compareAllProducts()">Compare All</button>
        </div>

        <table id="comparisonTable"></table>
    </div>

    <script>
        const productComparisonData = {
            "Sonel MIC-10K1": {
                "Measuring Voltage": "10kV",
                "Resistance Range": "40.0 TΩ",
                "DC and AC voltage measurement Range": "1500 V",
                "Capacitance Measurement Range": "49.99 µF",
                "Measurement of Leakage Current Range": "9.99 mA",
                "Short Circuit Current": "1.2mA, 3mA, 6mA",
                "Burn Mode": "Available",
                "IP": "IP 67",
                "Remote Control by Phone": "Available",
                "Data Transmission": "USB, Bluetooth",
                "Floors and Walls Resistance Measurement": "Available",
                "Standard": "EN 61557, EN 61326-1"
            },
            "Megger S1-1068": {
                "Measuring Voltage": "10kV",
                "Resistance Range": "35 TΩ",
                "DC and AC voltage measurement Range": "30 V to 660 V",
                "Capacitance Measurement Range": "10 nF to 25 μF",
                "Measurement of Leakage Current Range": "6 mA",
                "Short Circuit Current": "6 mA",
                "Burn Mode": "NA",
                "IP": "IP65",
                "Remote Control by Phone": "Remote control via USB cable only",
                "Data Transmission": "USB, Bluetooth",
                "Floors and Walls Resistance Measurement": "NA",
                "Standard": "NA"
            },
            "Megger MIT-1025": {
                "Measuring Voltage": "10kV",
                "Resistance Range": "20 TΩ",
                "DC and AC voltage measurement Range": "30 V to 660 V",
                "Capacitance Measurement Range": "10 nF to 50 μF",
                "Measurement of Leakage Current Range": "6 mA",
                "Short Circuit Current": "3 mA",
                "Burn Mode": "NA",
                "IP": "IP65",
                "Remote Control by Phone": "Remote control via USB cable only",
                "Data Transmission": "USB, Bluetooth",
                "Floors and Walls Resistance Measurement": "NA",
                "Standard": "NA"
            },
            "Fluke 1555": {
                "Measuring Voltage": "10kV",
                "Resistance Range": "2 TΩ",
                "DC and AC voltage measurement Range": "NA",
                "Capacitance Measurement Range": "20.00 μF",
                "Measurement of Leakage Current Range": "2 mA",
                "Short Circuit Current": "2 mA",
                "Burn Mode": "NA",
                "IP": "IP40",
                "Remote Control by Phone": "NA",
                "Data Transmission": "USB",
                "Floors and Walls Resistance Measurement": "NA",
                "Standard": "Available"
            },
            "Motwane 10K PI": {
                "Measuring Voltage": "10kV",
                "Resistance Range": "20 TΩ",
                "DC and AC voltage measurement Range": "600V",
                "Capacitance Measurement Range": "1 nF to 50 μF",
                "Measurement of Leakage Current Range": "3 mA",
                "Short Circuit Current": "3 mA",
                "Burn Mode": "NA",
                "IP": "IP54",
                "Remote Control by Phone": "Remote control via USB cable only",
                "Data Transmission": "USB, Bluetooth",
                "Floors and Walls Resistance Measurement": "NA",
                "Standard": "NA"
            },
            "Rishabh Insu-10Dx+": {
                "Measuring Voltage": "10kV",
                "Resistance Range": "20 TΩ",
                "DC and AC voltage measurement Range": "600V",
                "Capacitance Measurement Range": "1 nF to 50 μF",
                "Measurement of Leakage Current Range": "6 mA",
                "Short Circuit Current": "1.2mA, 3mA, 6mA",
                "Burn Mode": "NA",
                "IP": "IP67",
                "Remote Control by Phone": "NA",
                "Data Transmission": "USB, Bluetooth",
                "Floors and Walls Resistance Measurement": "NA",
                "Standard": "Available"
            }
        };

        function loadComparisonTable() {
            const selectedProduct = document.getElementById("productSelect").value;
            const selectedCompetitor = document.getElementById("competitorSelect").value;
            const selectedCompetitor2 = document.getElementById("competitorSelect2").value;

            const productData = productComparisonData[selectedProduct];
            const competitor1Data = selectedCompetitor && selectedCompetitor !== "none" ? productComparisonData[selectedCompetitor] : null;
            const competitor2Data = selectedCompetitor2 !== "none" ? productComparisonData[selectedCompetitor2] : null;

            // Header
            let tableContent = `<tr><th style="width: 30%;">Feature</th><th>${selectedProduct}</th>`;
            if (competitor1Data) tableContent += `<th>${selectedCompetitor}</th>`;
            if (competitor2Data) tableContent += `<th>${selectedCompetitor2}</th>`;
            tableContent += `</tr>`;

            const features = [
                "Measuring Voltage",
                "Short Circuit Current",
                "Resistance Range",
                "Floors and Walls Resistance Measurement",
                "Standard",
                "DC and AC voltage measurement Range",
                "Capacitance Measurement Range",
                "Measurement of Leakage Current Range",
                "Burn Mode",
                "IP",
                "Remote Control by Phone",
                "Data Transmission"
            ];

            features.forEach(feature => {
                tableContent += `<tr>
                    <td><strong>${feature}</strong></td>
                    <td>${productData[feature] || "NA"}</td>`;
                if (competitor1Data) tableContent += `<td>${competitor1Data[feature] || "NA"}</td>`;
                if (competitor2Data) tableContent += `<td>${competitor2Data[feature] || "NA"}</td>`;
                tableContent += `</tr>`;
            });

            document.getElementById("comparisonTable").innerHTML = tableContent;
        }

        function updateCompetitorOptions() {
            const selectedProduct = document.getElementById("productSelect").value;
            const competitors = Object.keys(productComparisonData).filter(p => p !== selectedProduct);

            const competitorSelect = document.getElementById("competitorSelect");
            const competitorSelect2 = document.getElementById("competitorSelect2");

            // Competitor 1
            competitorSelect.innerHTML = competitors.map(comp => 
                `<option value="${comp}">${comp}</option>`
            ).join("");

            // Competitor 2: None + others
            competitorSelect2.innerHTML = `<option value="none">None</option>` + 
                competitors.map(comp => 
                    `<option value="${comp}">${comp}</option>`
                ).join("");

            // Auto-select first competitor if none selected
            if (!competitorSelect.value) competitorSelect.selectedIndex = 0;
            if (competitorSelect2.value === "none" && competitorSelect2.options.length > 1) {
                // default: none
            }

            loadComparisonTable();
        }

        function compareAllProducts() {
            const allProducts = Object.keys(productComparisonData);
            let tableContent = `<tr><th>Feature</th>`;
            allProducts.forEach(p => tableContent += `<th>${p}</th>`);
            tableContent += `</tr>`;

            const firstProduct = allProducts[0];
            for (let feature in productComparisonData[firstProduct]) {
                tableContent += `<tr><td><strong>${feature}</strong></td>`;
                allProducts.forEach(p => {
                    tableContent += `<td>${productComparisonData[p][feature] || "NA"}</td>`;
                });
                tableContent += `</tr>`;
            }

            document.getElementById("comparisonTable").innerHTML = tableContent;
        }

        function exportToPDF() {
            const { jsPDF } = window.jspdf;
            const table = document.getElementById("comparisonTable");

            html2canvas(table, { scale: 2 }).then(canvas => {
                const imgData = canvas.toDataURL("image/png");
                const pdf = new jsPDF("l", "mm", "a4");
                const imgWidth = 280;
                const pageHeight = 295;
                const imgHeight = (canvas.height * imgWidth) / canvas.width;
                let heightLeft = imgHeight;

                let position = 20;
                pdf.setFontSize(16);
                pdf.text("Product Comparison Report", 14, 15);

                pdf.addImage(imgData, "PNG", 10, position, imgWidth, imgHeight);
                heightLeft -= pageHeight;

                while (heightLeft >= 0) {
                    position = heightLeft - imgHeight;
                    pdf.addPage();
                    pdf.addImage(imgData, "PNG", 10, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;
                }

                pdf.save("product-comparison.pdf");
            });
        }

        // Initialize
        updateCompetitorOptions();
    </script>
</body>
</html>
